doctype html
html
  head
    meta(charset='UTF-8')
    meta(name='viewport' content='width=device-width, initial-scale=1.0')
    title Update Sale
    link(href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css' rel='stylesheet')
  body
    h1 Update Sale
    .container
      form#sales-form(action='/sales/updateSale?id=' + sale._id method='post')
        .mb-3
          label.form-label(for='produceName') Produce Name
          select#produceName.form-control(name='producename')
            each product in products
              option(
                value=product._id
                selected=(sale.producename && sale.producename._id.toString() === product._id.toString())
              ) #{product.producename}
          span#nameError.error.text-danger

        .mb-3
          label.form-label(for='buyersName') Buyer's Name
          input#buyersName.form-control(type='text' name='buyersname' value=sale.buyersname)
          span#buyerError.error.text-danger

        .mb-3
          label.form-label(for='dateTime') Date & Time
          - const dateValue = sale.dateandtime ? new Date(sale.dateandtime).toISOString().slice(0, 16) : ''
          input#dateTime.form-control(type='datetime-local' name='dateandtime' value=dateValue)
          span#dateError.error.text-danger

        .mb-3
          label.form-label(for='tonnage') Tonnage (in kgs)
          input#tonnage.form-control(type='number' min='1' name='tonnage' value=sale.tonnage)
          span#tonnageError.error.text-danger

        .mb-3
          label.form-label(for='cost') Amount Paid (in UgX)
          input#cost.form-control(type='number' min='1' name='amountpaid' value=sale.amountpaid)
          span#amountError.error.text-danger

        .mb-3
          label.form-label(for='salesAgentName') Sales Agent's Name
          select#salesAgentName.form-control(name='salesagent')
            if currentUser
              option(
                value=currentUser._id
                selected=(sale.salesagent && sale.salesagent._id.toString() === currentUser._id.toString())
              ) #{currentUser.name}
          span#agentError.error.text-danger

        .mb-3
          label.form-label(for='paymentMethod') Payment Method
          select#paymentMethod.form-control(name='paymentmethod')
            option(value='' selected=!sale.paymentmethod) Select Payment Method
            option(value='mobilemoney' selected=sale.paymentmethod === 'mobilemoney') Mobile Money
            option(value='cash' selected=sale.paymentmethod === 'cash') Cash
            option(value='banktransfer' selected=sale.paymentmethod === 'banktransfer') Bank Transfer
          span#paymentError.error.text-danger

        .mb-3
          label.form-label(for='branch') Branch
          select#branch.form-control(name='branch')
            option(value='' selected=!sale.branch) Select Branch
            option(value='maganjo' selected=sale.branch === 'maganjo') Maganjo
            option(value='matugga' selected=sale.branch === 'matugga') Matugga
          span#branchError.error.text-danger

        button.btn.btn-primary(type='submit') Submit

    script(src='/js/sales.js')
